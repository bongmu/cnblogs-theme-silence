"use strict";
var _createClass = function() {
    function n(e, t) {
        for (var a = 0; a < t.length; a++) {
            var n = t[a];
            n.enumerable = n.enumerable || !1,
            n.configurable = !0,
            "value" in n && (n.writable = !0),
            Object.defineProperty(e, n.key, n)
        }
    }
    return function(e, t, a) {
        return t && n(e.prototype, t),
        a && n(e, a),
        e
    }
} ();
function _classCallCheck(e, t) {
    if (! (e instanceof t)) throw new TypeError("Cannot call a class as a function")
} !
function(u) {
    u.extend({
        silence: function(e) {
            var t = new a;
            t.init(e)
        }
    });
    var a = function() {
        function e() {
            _classCallCheck(this, e),
            this.defaluts = {
                catalog: {
                    enable: !1,
                    move: !0,
                    index: !0,
                    level1: "h2",
                    level2: "h3",
                    level3: "h4"
                },
                signature: {
                    enable: !1,
                    author: currentBlogApp,
                    home: "https://www.cnblogs.com",
                    license: "缃插悕 4.0 鍥介檯",
                    link: "https://creativecommons.org/licenses/by/4.0"
                },
                reward: {
                    enable: !1,
                    title: "鎴戞槸鐚村瓙娲炬潵鏀堕挶鐨�",
                    wechat: null,
                    alipay: null
                },
                github: {
                    enable: !1,
                    color: "#fff",
                    fill: "#151513",
                    link: null
                }
            }
        }
        return _createClass(e, [{
            key: "init",
            value: function(e) {
                e && u.extend(!0, this.defaluts, e),
                this.buildNavCustomElements(),
                this.buildCopyright(),
                this.buildGithubCorners(),
                this.isPostPage ? (this.goIntoReadingMode(), this.buildPostCatalog(), this.buildPostSignature(), this.buildPostFavoriteBtn(), this.buildPostRewardBtn(), this.buildPostCommentAvatar(), this.buildPostCodeCopyBtn(), this.buildFollowBtn()) : this.goIntoNormalMode()
            }
        },
        {
            key: "showMessage",
            value: function(e) {
                u(".esa-layer").length || u("body").prepend('<div class="esa-layer"><span class="esa-layer-content"></span></div>'),
                u(".esa-layer-content").html(e),
                u(".esa-layer").fadeIn(200),
                setTimeout(function() {
                    u(".esa-layer").fadeOut(200,
                    function() {
                        u(".esa-layer-content").empty()
                    })
                },
                2e3)
            }
        },
        {
            key: "goIntoReadingMode",
            value: function() {
                var t = this,
                a = 0,
                e = u(window);
                767 < e.width() && e.scroll(function() {
                    var e = this.scrollY;
                    a < e ? u(t.cnblogs.header).slideUp() : u(t.cnblogs.header).slideDown(),
                    a = this.scrollY
                })
            }
        },
        {
            key: "goIntoNormalMode",
            value: function() {
                767 < u(window).width() && (u(this.cnblogs.forFlow).css({
                    marginLeft: "22em"
                }), u(this.cnblogs.sideBar).fadeIn(700))
            }
        },
        {
            key: "buildNavCustomElements",
            value: function() {
                var e = this,
                t = u(this.cnblogs.navList);
                t.find("li").eq(1).after('<li><a id="blog_nav_tags" class="menu" href="https://www.cnblogs.com/' + currentBlogApp + '/tag">鏍囩</a></li>'),
                u.each(t.find("li"),
                function(e, t) {
                    u(t).append("<i></i>")
                }),
                u("body").prepend('<div class="esa-mobile-menu"></div>'),
                u(".esa-mobile-menu").on("click",
                function() {
                    u(e.cnblogs.navigator).fadeToggle(200)
                })
            }
        },
        {
            key: "buildCopyright",
            value: function() {
                var e = '<div> Powered By <a href="https://www.cnblogs.com" target="_blank">Cnblogs</a> |\n            Theme <a href="https://github.com/esofar/cnblogs-theme-silence" target="_blank">Silence ' + this.version + "</a></div>";
                u(this.cnblogs.footer).append(e)
            }
        },
        {
            key: "buildPostSignature",
            value: function() {
                var e = this.defaluts.signature;
                if (e.enable) {
                    var t = u(this.cnblogs.postTitle).attr("href"),
                    a = '<div class="esa-post-signature"> \n                    <p>浣滆€咃細<a href="' + e.home + '">' + e.author + '</a></p> \n                    <p>鍑哄锛�<a href="' + t + '">' + t + '</a></p> \n <p>濡傛灉鏈枃瀵逛綘鏈夌敤,娆㈣繋<a href="javascript:void(0);" onclick="follow('+cb_blogUserGuid+')">銆屽叧娉ㄣ€�</a>鍜�<a href="javascript:void(0);" onclick="vorePost('+cb_entryId+')">銆屾帹鑽愩€�</a>璧颁竴娉�,涓嶅畾鏈熸帹鍑哄疄鐢ㄥ共璐�,鑱旂郴鏂瑰紡<a href="mailto:liuzhenyu@live.com?subject=鍗氬鍥鑰�">liuzhenyu@live.com</a></p> \n                   <p>鏈珯浣跨敤銆�<a href="' + e.link + '"  target="_blank">' + e.license + "</a>銆嶅垱浣滃叡浜崗璁紝娉ㄦ槑鍑哄鍗冲彲闅忔剰杞浇,鏃犻渶鑱旂郴鏈汉.醿瘁兇醿粹潧鈥库潧醿瘁兇醿�</p> \n                </div>";
                    u(this.cnblogs.mySignature).html(a).show()
                }
            }
        },
        {
            key: "buildPostCommentAvatar",
            value: function() {
                var s = this,
                e = function() {
                    u(s.cnblogs.postCommentBody).before("<div class='esa-comment-avatar'><a target='_blank'><img /></a></div>");
                    for (var e = u(s.cnblogs.feedbackContent), t = 0; t < e.length; t++) {
                        var a = "https://pic.cnblogs.com/face/sample_face.gif",
                        n = u(e[t]).find("span:last")[0];
                        n && (a = u(n).html().replace("http://", "//")),
                        u(e[t]).find(".esa-comment-avatar img").attr("src", a);
                        var o = u(e[t]).parent().find(".comment_date").next().attr("href");
                        u(e[t]).find(".esa-comment-avatar a").attr("href", o)
                    }
                };
                if (u(s.cnblogs.postCommentBody).length) e();
                else var t = 1,
                a = setInterval(function() {
                    u(s.cnblogs.postCommentBody).length && (clearInterval(a), e()),
                    10 == t && clearInterval(a),
                    t++
                },
                500)
            }
        },
        {
            key: "buildPostRewardBtn",
            value: function() {
                var e = this.defaluts.reward,
                t = this;
                if (e.enable) {
                    if (!e.wechat && !e.alipay) throw new Error("silence error: both 'wechat' and 'alipay' are null in reward module.");
                    var a = '<div class="esa-reward">\n                <div class="esa-reward-close">+</div>\n                <h2>"' + e.title + '"</h2>\n                <div class="esa-reward-container">';
                    e.wechat && (a += '<div class="wechat"><img src="' + e.wechat + '" alt="寰俊鏀粯"></div>'),
                    e.alipay && (a += '<div class="alipay"><img src="' + e.alipay + '" alt="鏀粯瀹濇敮浠�"></div>'),
                    a += "</div></div>",
                    u("body").append(a),
                    u(".esa-reward-close").on("click",
                    function() {
                        u(".esa-reward").fadeOut()
                    });
                    var n = function() {
                        u(t.cnblogs.postDigg).prepend('<div class="reward"><span class="rewardnum" id="reward_count"></span></div>'),
                        u(t.cnblogs.postDigg).find(".reward").on("click",
                        function() {
                            u(".esa-reward").fadeIn()
                        })
                    };
                    if (u(t.cnblogs.postDigg).length) n();
                    else var o = setInterval(function() {
                        u(t.cnblogs.postDigg).length && (clearInterval(o), n())
                    },
                    200)
                } else u(t.cnblogs.postDigg).width(300)
            }
        },
        {
            key: "buildPostFavoriteBtn",
            value: function() {
                var e = this,
                t = function() {
                    u(e.cnblogs.postDigg).prepend('<div class="favorite" onclick="AddToWz(cb_entryId);return false;"><span class="favoritenum" id="favorite_count"></span></div>')
                };
                if (u(e.cnblogs.postDigg).length) t();
                else var a = setInterval(function() {
                    u(e.cnblogs.postDigg).length && (clearInterval(a), t())
                },
                200)
            }
        },
        {
            key: "buildPostCatalog",
            value: function() {
                var s = this.defaluts.catalog;
                if (s.enable) {
                    var e = [s.level1, s.level2, s.level3],
                    t = u(this.cnblogs.postBody).find(e.join(","));
                    if (!t.length) return ! 1;
                    var a = u('<div class="esa-catalog">\n                        <div class="esa-catalog-tab"><h2>鐩綍</h2></div>\n                        <div class="esa-catalog-contents">\n                            <div class="esa-catalog-title"><h2>鐩綍</h2></div>\n                            <a class="esa-catalog-close">X</a>\n                        </div>\n                    </div>'),
                    l = 0,
                    i = 0,
                    r = 0,
                    c = "<ul>";
                    u.each(t,
                    function(e, t) {
                        var a = u(t)[0].tagName.toLowerCase(),
                        n = "",
                        o = u(t).text();
                        if (s.index) a === s.level1 ? (r = i = 0, n = '<span class="level1">' + ++l + ". </span>") : a === s.level2 ? (r = 0, n = '<span class="level2">' + l + "." + ++i + ". </span>") : a === s.level3 && (n = '<span class="level3">' + l + "." + i + "." + ++r + ". </span>");
                        else switch (a) {
                        case s.level1:
                            o = '<span class="level1">' + o + "</span>";
                            break;
                        case s.level2:
                            o = '<span class="level2">' + o + "</span>";
                            break;
                        case s.level3:
                            o = '<span class="level3">' + o + "</span>"
                        }
                        c += '<li class="li_' + a + '" title="' + o + '">\n                        <i id="esa_index_' + e + '"></i><a class="esa-anchor-link">' + (n + o) + "</a>\n                    </li>",
                        u(t).attr("id", "esa_index_" + e)
                    }),
                    c += "</ul>",
                    a.find(".esa-catalog-contents").append(c),
                    a.appendTo("body");
                    var n = u(".esa-catalog-tab"),
                    o = u(".esa-catalog-contents");
                    o.fadeIn();
                    if (u(".esa-anchor-link").on("click",
                    function() {
                        var e = u(this).prev("i").attr("id"),
                        t = u("#" + e).offset().top - 70;
                        u("html, body").animate({
                            scrollTop: t
                        },
                        300)
                    }), n.on("click",
                    function() {
                        u(this).hide(),
                        o.show()
                    }), u(".esa-catalog-close").on("click",
                    function() {
                        o.hide(),
                        n.show()
                    }), s.move) {
                        var d = {
                            start: !1,
                            pois: [0, 0]
                        };
                        u(".esa-catalog-title, .esa-catalog").on("mousedown",
                        function(e) {
                            e.preventDefault(),
                            d.start = !0;
                            var t = u(".esa-catalog").position(),
                            a = e.clientX - parseFloat(t.left),
                            n = e.clientY - parseFloat(t.top);
                            d.pois = [a, n]
                        }),
                        u(document).on("mousemove",
                        function(e) {
                            if (d.start) {
                                var t = e.clientX - d.pois[0],
                                a = e.clientY - d.pois[1],
                                n = "fixed" === u(".esa-catalog").css("position");
                                e.preventDefault(),
                                d.stX = n ? 0 : u(window).scrollLeft(),
                                d.stY = n ? 0 : u(window).scrollTop();
                                var o = u(window).width() - u(".esa-catalog").outerWidth() + d.stX,
                                s = u(window).height() - u(".esa-catalog").outerHeight() + d.stY;
                                t < d.stX && (t = d.stX),
                                o < t && (t = o),
                                a < d.stY && (a = d.stY),
                                s < a && (a = s),
                                u(".esa-catalog").css({
                                    left: t,
                                    top: a,
                                    right: "auto"
                                })
                            }
                        }).on("mouseup",
                        function(e) {
                            d.start && (d.start = !1)
                        })
                    }
                }
            }
        },
        {
            key: "buildGithubCorners",
            value: function() {
                var e = this.defaluts.github;
                e.enable && u("body").append('<a href="' + e.link + '" class="github-corner" title="Follow me on GitHub">\n                        <svg width="60" height="60" viewBox="0 0 250 250" style="fill:' + e.fill + "; color:" + e.color + '; z-index: 999999; position: fixed; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true">\n                            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>\n                            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>\n                            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>\n                        </svg>\n                    </a>')
            }
        },
        {
            key: "buildPostCodeCopyBtn",
            value: function() {
                var t = this,
                e = u(this.cnblogs.postBody).find("pre");
                if (!e.length) return ! 1;
                u.each(e,
                function(e, t) {
                    u(t).find("code").attr("id", "copy_target_" + e),
                    u(t).prepend('<div class="esa-clipboard-button" data-clipboard-target="#copy_target_' + e + '">Copy</div>')
                }),
                u.getScript("https://unpkg.com/clipboard@2.0.0/dist/clipboard.min.js",
                function() {
                    var e = new ClipboardJS(".esa-clipboard-button");
                    e.on("success",
                    function(e) {
                        t.showMessage("澶嶅埗鎴愬姛"),
                        e.clearSelection()
                    }),
                    e.on("error",
                    function(e) {
                        t.showMessage("澶嶅埗澶辫触")
                    })
                })
            }
        },
        {
            key: "buildFollowBtn",
            value: function() {
                var e = this;
                u("body").append('<button class="esa-follow-button">鍏虫敞</button>');
                var t = u(".esa-follow-button");
                t.on("click",
                function() {
                    if (isLogined || login(), c_has_follwed) return e.showMessage("鎮ㄥ凡缁忓叧娉ㄨ繃鎴戜簡");
                    follow(cb_blogUserGuid)
                }),
                u(window).scroll(function() {
                    200 < this.scrollY ? t.fadeIn() : t.fadeOut()
                })
            }
        },
        {
            key: "version",
            get: function() {
                return "v1.1.0"
            }
        },
        {
            key: "cnblogs",
            get: function() {
                return {
                    header: "#header",
                    navigator: "#navigator",
                    navList: "#navList",
                    sideBar: "#sideBar",
                    forFlow: ".forFlow",
                    postTitle: "#cb_post_title_url",
                    postDetail: "#post_detail",
                    postBody: "#cnblogs_post_body",
                    postDigg: "#div_digg",
                    postCommentBody: ".blog_comment_body",
                    feedbackContent: ".feedbackCon",
                    mySignature: "#MySignature",
                    footer: "#footer"
                }
            }
        },
        {
            key: "isPostPage",
            get: function() {
                return 0 < u(this.cnblogs.postDetail).length
            }
        }]),
        e
    } ()
} (jQuery);